# Benjamin Morgan benjamin.s.morgan@outlook.com 
<# Ref: { Mircosoft docs links
    Get-AzResourceGroup:        https://docs.microsoft.com/en-us/powershell/module/az.resources/get-azresourcegroup?view=azps-5.1.0
    New-AzKeyVault:             https://docs.microsoft.com/en-us/powershell/module/az.keyvault/new-azkeyvault?view=azps-5.3.0
    Get-AzKeyVault:             https://docs.microsoft.com/en-us/powershell/module/az.keyvault/get-azkeyvault?view=azps-5.1.0
    Remove-AzKeyVault:          https://docs.microsoft.com/en-us/powershell/module/az.keyvault/remove-azkeyvault?view=azps-5.3.0
    Get-AzKeyVaultSecret:       https://docs.microsoft.com/en-us/powershell/module/az.keyvault/get-azkeyvaultsecret?view=azps-5.1.0
    Set-AzKeyVaultSecret:       https://docs.microsoft.com/en-us/powershell/module/az.keyvault/set-azkeyvaultsecret?view=azps-5.1.0
    Remove-AzKeyVaultSecret:    https://docs.microsoft.com/en-us/powershell/module/az.keyvault/remove-azkeyvaultsecret?view=azps-5.1.0
} #>
<# Required Functions Links: {
    NewAzKeyVault:              https://github.com/benjaminsmorgan/Azure-Powershell/blob/main/Storage/KeyVault/NewAzKeyVault.ps1
    ListAzKeyVault:             https://github.com/benjaminsmorgan/Azure-Powershell/blob/main/Storage/KeyVault/ListAzKeyVault.ps1
    GetAzKeyVault:              https://github.com/benjaminsmorgan/Azure-Powershell/blob/main/Storage/KeyVault/GetAzKeyVault.ps1
    RemoveAzKeyVault:           https://github.com/benjaminsmorgan/Azure-Powershell/blob/main/Storage/KeyVault/RemoveAzKeyVault.ps1
    ManageAzKeyVaultKey:        TBD
        NewAzKeyVaultKey:           TBD
        ListAzKeyVaultKey:          TBD
        GetAzKeyVaultKey:           TBD
        RemoveAzKeyVaultKey:        TBD
    ManageAzKeyVaultSecret:     TBD
        NewAzKeyVaultSecret:        TBD
        ListAzKeyVaultSecret:       TBD
        GetAzKeyVaultSecret:        https://github.com/benjaminsmorgan/Azure-Powershell/blob/main/Storage/KeyVault/Secrets/GetAzKeyVaultSecret.ps1
        ShowAzKeyVaultSecret:       TBD
        RemoveAzKeyVaultSecret:     https://github.com/benjaminsmorgan/Azure-Powershell/blob/main/Storage/KeyVault/Secrets/RemoveAzKeyVaultSecret.ps1
    GetAzResourceGroup:         https://github.com/benjaminsmorgan/Azure-Powershell/blob/main/Resource%20Groups/GetAzResourceGroup.ps1 
} #>
<# Functions Description: {
    ManageAzKeyVault:            Management function for key vaults
        NewAzKeyVault:              Creates new key vault object
        ListAzKeyVault:             Lists all key vaults in subscription
        GetAzKeyVault:              Gets $KeyVaultObject
        RemoveAzKeyVault:           Removes $KeyVaultObject
        ManageAzKeyVaultKey:        Management function for key vault keys
            NewAzKeyVaultKey:           TBD
            ListAzKeyVaultKey:          TBD
            GetAzKeyVaultKey:           TBD
            RemoveAzKeyVaultKey:        TBD
        ManageAzKeyVaultSecret:     Management function for key vault secrets
            NewAzKeyVaultSecret:        TBD
            ListAzKeyVaultSecret:       TBD
            GetAzKeyVaultSecret:        Gets $KeyVaultSecretObject
            ShowAzKeyVaultSecret:       Displays $KeyVaultSecretObject in plain text
            RemoveAzKeyVaultSecret:     Removes $KeyVaultSecretObject
        GetAzResourceGroup:         Collects resource group object
} #>
<# Variables: {
    :ManageAureKeyVault         Outer loop for managing function
    $ManageAzKeyVaultSelect:    Operator input for selecting management function
    $RGObject:                  Resource group object
    $KeyVaultObject:            Key vault object
    NewAzKeyvault{}             Creates $KeyVaultObject
        GetAzResourceGroup{}        Gets $RGObject
    ListAzKeyVault{}            Lists all key vaults in subscription
    GetAzKeyVault{}             Gets $KeyVaultObject
        GetAzResourceGroup{}        Gets $RGObject
    RemoveAzKeyVault{}          Removes $KeyVaultObject
        GetAzKeyVault{}             Gets $KeyVaultObject
            GetAzResourceGroup{}        Gets $RGObject
    ManageAzKeyVaultKey{}       Manages $KeyVaultKeyObject
        NewAzKeyVaultKey{}          Creates $KeyVaultKeyObject
            GetAzKeyVault{}             Gets $KeyVaultObject
                GetAzResourceGroup{}        Gets $RGObject
        ListAzKeyVaultKey{}         Lists all key vault keys in vault
            GetAzKeyVault{}             Gets $KeyVaultObject
                GetAzResourceGroup{}        Gets $RGObject
        GetAzKeyVaultKey{}          Gets $KeyVaultKeyObject
            GetAzKeyVault{}             Gets $KeyVaultObject
                GetAzResourceGroup{}        Gets $RGObject
        RemoveAzKeyVaultKey{}       Removes $KeyVaultKeyObject
            GetAzKeyVaultKey{}          Gets $KeyVaultKeyObject
                GetAzKeyVault{}             Gets $KeyVaultObject
                    GetAzResourceGroup{}        Gets $RGObject
    ManageAzKeyVaultSecret{}    Manages $KeyVaultSecretObject
        NewAzKeyVaultSecret{}       Creates $KeyVaultSecretObject
            GetAzKeyVault{}             Gets $KeyVaultObject
                GetAzResourceGroup{}        Gets $RGObject
        ListAzKeyVaultSecret{}      Lists all secrets in key vault
            GetAzKeyVault{}             Gets $KeyVaultObject
                GetAzResourceGroup{}        Gets $RGObject
        GetAzKeyVaultSecret{}       Gets $KeyVaultSecretObject
            GetAzKeyVault{}             Gets $KeyVaultObject
                GetAzResourceGroup{}        Gets $RGObject
        ShowAzKeyVaultSecret{}      Gets plain text of $KeyVaultSecretObject value
            GetAzKeyVaultSecret{}       Gets $KeyVaultSecretObject
                GetAzKeyVault{}             Gets $KeyVaultObject
                    GetAzResourceGroup{}        Gets $RGObject
        RemoveAzKeyVaultSecret{}    Removes $KeyVaultSecretObject
            GetAzKeyVaultSecret{}       Gets $KeyVaultSecretObject
                GetAzKeyVault{}             Gets $KeyVaultObject
                    GetAzResourceGroup{}        Gets $RGObject
} #>
<# Process Flow {
    Function
        Call ManageAzKeyVault > Get $null
            Call NewAzKeyvault
                Call GetAzResource Group > Get $RGObject
                End GetAzResourceGroup
                    Return NewAzKeyVault > Send $RGObject
            End NewAzKeyvault
                Return ManageAzKeyVault > Send $KeyVaultObject
            Call ListAzKeyVault
            End ListAzKeyVault
                Return ManageAzKeyVault > Send $null
            Call GetAzKeyVault
                Call GetAzResource Group > Get $RGObject
                End GetAzResourceGroup
                    Return GetAzKeyVault > Send $RGObject
            End GetAzKeyVault
                Return ManageAzKeyVault > Send $KeyVaultObject
            Call RemoveAzKeyVault
                Call GetAzKeyVault
                    Call GetAzResource Group > Get $RGObject
                    End GetAzResourceGroup
                    Return GetAzKeyVault > Send $RGObject
                End GetAzKeyVault
                Return RemoveAzKeyVault > Send $KeyVaultObject
            End RemoveAzKeyVault
                Return ManageAzKeyVault > Send $null
            Call ManageAzKeyVaultKey
                Call NewAzKeyVaultKey
                    Call GetAzKeyVault
                        Call GetAzResource Group > Get $RGObject
                        End GetAzResourceGroup
                            Return GetAzKeyVault > Send $RGObject
                    End GetAzKeyVault
                        Return NewAzKeyVaultKey > Send $KeyVaultObject
                End NewAzKeyVaultKey
                    Return ManageAzKeyVaultKey > Send $KeyVaultKeyObject
                Call ListAzKeyVaultKey
                    Call GetAzKeyVault
                        Call GetAzResource Group > Get $RGObject
                        End GetAzResourceGroup
                            Return GetAzKeyVault > Send $RGObject
                    End GetAzKeyVault
                        Return ListAzKeyVaultKey > Send $KeyVaultObject
                End ListAzKeyVaultKey
                    Return ManageAzKeyVaultKey > Send $null
                Call GetAzKeyVaultKey
                    Call GetAzKeyVault
                        Call GetAzResource Group > Get $RGObject
                        End GetAzResourceGroup
                            Return GetAzKeyVault > Send $RGObject
                    End GetAzKeyVault
                        Return GetAzKeyVaultKey > Send $KeyVaultObject
                End GetAzKeyVaultKey
                    Return ManageAzKeyVaultKey > Send $KeyVaultKeyObject
                Call RemoveAzKeyVaultKey
                    Call GetAzKeyVaultKey
                        Call GetAzKeyVault
                            Call GetAzResource Group > Get $RGObject
                            End GetAzResourceGroup
                                Return GetAzKeyVault > Send $RGObject
                        End GetAzKeyVault
                            Return GetAzKeyVaultKey > Send $KeyVaultObject
                    End GetAzKeyVaultKey
                        Return RemoveAzKeyVaultKey > Send $KeyVaultKeyObject
                End RemoveAzKeyVaultKey
                    Return ManageAzKeyVaultKey > Send null
            End ManageAzKeyVaultKey
                Return ManageAzKeyVault > Send $null
            Call ManageAzKeyVaultSecret
                Call NewAzKeyVaultSecret
                    Call GetAzKeyVault
                        Call GetAzResource Group > Get $RGObject
                        End GetAzResourceGroup
                            Return GetAzKeyVault > Send $RGObject
                    End GetAzKeyVault
                        Return NewAzKeyVaultSecret > Send $KeyVaultObject
                End NewAzKeyVaultSecret
                    Return ManageAzKeyVaultSecret > Send $KeyVaultSecretObject
                Call ListAzKeyVaultSecret
                    Call GetAzKeyVault
                        Call GetAzResource Group > Get $RGObject
                        End GetAzResourceGroup
                            Return GetAzKeyVault > Send $RGObject
                    End GetAzKeyVault
                        Return ListAzKeyVaultSecret > Send $KeyVaultObject
                End ListAzKeyVaultSecret
                    Return ManageAzKeyVaultSecret > Send $null
                Call GetAzKeyVaultSecret
                    Call GetAzKeyVault
                        Call GetAzResource Group > Get $RGObject
                        End GetAzResourceGroup
                            Return GetAzKeyVault > Send $RGObject
                    End GetAzKeyVault
                        Return GetAzKeyVaultSecret > Send $KeyVaultObject
                End GetAzKeyVaultSecret
                    Return ManageAzKeyVaultSecret > Send $KeyVaultSecretObject
                Call ShowAzKeyVaultSecret
                    Call GetAzKeyVaultSecret
                        Call GetAzKeyVault
                            Call GetAzResource Group > Get $RGObject
                            End GetAzResourceGroup
                                Return GetAzKeyVault > Send $RGObject
                        End GetAzKeyVault
                            Return GetAzKeyVaultSecret > Send $KeyVaultObject
                    End GetAzKeyVaultSecret
                        Return ShowAzKeyVaultSecret > Send $KeyVaultSecretObject
                End ShowAzKeyVaultSecret
                    Return ManageAzKeyVaultSecret > Send $null
                Call RemoveAzKeyVaultSecret
                    Call GetAzKeyVaultSecret
                        Call GetAzKeyVault
                            Call GetAzResource Group > Get $RGObject
                            End GetAzResourceGroup
                                Return GetAzKeyVault > Send $RGObject
                        End GetAzKeyVault
                            Return GetAzKeyVaultSecret > Send $KeyVaultObject
                    End GetAzKeyVaultSecret
                        Return RemoveAzKeyVaultSecret > Send $KeyVaultSecretObject
                End RemoveAzKeyVaultSecret
                    Return ManageAzKeyVaultSecret > Send $null
            End ManageAzKeyVaultSecret
                Return ManageAzKeyVault > Send $null
        End ManageAzKeyVault
            Return function > Send $null
}#>
function ManageAzKeyVault { # Script for managing Azure
    Begin {
        :ManageAzureKeyVault while ($true) { # Outer loop for managing function
            if ($RGObject) { # If $RGObject has a value
                Write-Host '$RGObject:' $RGObject.ResourceGroupName # Write message to screen 
            } # End if ($RGObject)
            if ($KeyVaultObject) { # If $KeyVaultObject has a value
                Write-Host '$KeyVaultObject:' $KeyVaultObject.VaultName # Write message to screen
            } # End if ($KeyVaultObject)
            if ($RGObject -or $KeyVaultObject) { # If $RGObject or $KeyVault Object has a value
                Write-Host '0 to clear $RGObject and $KeyVaultObject' # Write message to screen
            } # End if ($RGObject -or $KeyVaultObject)
            Write-Host "1 New Key Vault" # Write message to screen
            Write-Host "2 List All Key Vaults" # Write message to screen
            Write-Host "3 Get Key Vault" # Write message to screen
            Write-Host "4 Remove Key Vault" # Write message to screen
            Write-Host "5 Manage Key Vault Keys" # Write message to screen
            Write-Host "6 Manage Key Vault Secrets" # Write message to screen
            Write-Host "'Exit' to end script" # Write option list to screen
            $ManageAzKeyVaultSelect = Read-Host "Chose option" # Operator input for which option they need to run
            if ($ManageAzKeyVaultSelect -eq '1') { # Elseif statement for option 1
                Write-Host "New Key Vault" # Option selection write to screen
                $KeyVaultObject = NewAzKeyVault ($RGObject) # Calls function NewAzKeyVault
            } # End if statement
            elseif ($ManageAzKeyVaultSelect -eq '2') { # Elseif statement for option 2
                Write-Host "List All Key Vaults" # Option selection write to screen
                ListAzKeyVault # Calls function ListAzKeyVault
            } # End elseif statement
            elseif ($ManageAzKeyVaultSelect -eq '3') { # Elseif statement for option 3
                Write-Host "Get Key Vault" # Option selection write to screen
                $KeyVaultObject = GetAzKeyVault ($RGObject) # Calls function GetAzKeyVault
            } # End elseif statement
            elseif ($ManageAzKeyVaultSelect -eq '4') { # Elseif statement for option 4
                Write-Host "Remove Key Vault" # Option selection write to screen
                RemoveAzKeyVault ($KeyVaultObject) # Calls function RemoveAzKeyVault
            } # End elseif statement
            elseif ($ManageAzKeyVaultSelect -eq '5') { # Elseif statement for option 5
                Write-Host "Manage Key Vault Keys" # Option selection write to screen
                ManageAzKeyVaultKey ($RGObject, $KeyVaultObject) # Calls function ManageAzKeyVaultKey
            } # End elseif statement
            elseif ($ManageAzKeyVaultSelect -eq '6') { # Elseif statement for option 6
                Write-Host "Manage Key Vault Secrets" # Option selection write to screen
                ManageAzKeyVaultSecret ($RGObject, $KeyVaultObject) # Calls function ManageAzKeyVaultSecret
            } # End elseif statement
            elseif ($ManageAzKeyVaultSelect -eq '0') { # Elseif statement for option 0
                $RGObject = $null # Sets $var to $null
                $KeyVaultObject = $null # Sets $var to $null
                Write-Host '$RGObject and $KeyVaultObject have been cleared'
            } # End elseif ($ManageAzKeyVaultSelect -eq '0')
            elseif ($ManageAzKeyVaultSelect -eq 'exit') { # Elseif statement for ending the srcipt
                Break ManageAzureKeyVault # Breaks :ManageAzureKeyVault
            } # End elseif statement
            else { # Esle statement for all other values
                Write-Host "Invalid option" # Option selection write to screen
            } # End else statement
        } # End :ManageAzureKeyVault while ($true)
        Return # Returns to calling function with $null
    } # End begin statemnt
} # End ManageAzKeyVault
function NewAzKeyVault { # Creates a new key vault
    Begin {
        $ErrorActionPreference='silentlyContinue' # Turns off error reporting
        :NewAzureKeyVault while ($true) { # Outer loop for managing function
            if (!$RGObject) { # If $RGObject is $null
                $RGObject = GetAzResourceGroup  # Calls GetAzResourceGroup and assigns to $RGObject
                if (!$RGObject) { # If $RGObject is still $null
                    Break NewAzureKeyVault # Breaks NewAzureKeyVault loop
                } # End if (!$RGObject)
            } # End if (!$RGObject)
            :SetAzureKeyVaultName while ($true) { # Inner loop for setting the key vault name
                $KeyVaultNameInput = '0' # Assigns a value for elseif statement if operator input is invalid
                try { # Try statement for operator input of vault name
                    [ValidatePattern('^[a-z,0-9]+$')]$KeyVaultNameInput = [string](Read-Host "New vault name (3-24 letters and numbers only)") # Operator input for the vault name, only allows letters and numbers. All letters converted to lowercase
                } # End try
                catch {Write-Host "The vault name can only include letters and numbers"} # Error message for failed try
                if ($KeyVaultNameInput -eq 'exit') { # $KeyVaultNameInput is equal to exit
                    Break NewAzureKeyVault # Breaks NewAzureKeyVault loop
                } # if ($KeyVaultNameInput -eq 'exit')
                elseif ($KeyVaultNameInput -eq '0') {}# Elseif when Try statement fails
                elseif ($KeyVaultNameInput.Length -le 2 -or $KeyVaultNameInput.Length -ge 25) { # If $KeyVaultNameInput is not between 3 and 24 characters
                    Write-Host "The vault name must be between 3 and 24 characters in length" # Write message to screen
                } # End elseif ($KeyVaultNameInput.Length -le 2 -or $KeyVaultNameInput.Length -ge 25)
                else { # If Try statement input has value not equal to exit
                    Write-Host $KeyVaultNameInput # Writes $var to screen
                    $OperatorConfirm = Read-Host "Is this name correct [Y] or [N]" # Operator confirmation
                    if ($OperatorConfirm -eq 'y' -or $OperatorConfirm -eq 'yes') { # If $OperatorConfirm is equal to 'y' or 'yes'
                        Break SetAzureKeyVaultName # Breaks SetAzureKeyVaultName
                    } # End If ($OperatorConfirm -eq 'y' -or $OperatorConfirm -eq 'yes')
                    else {} # If $OperatorConfirm is not -eq 'y' or 'yes;
                } # End else (if ($KeyVaultNameInput -eq 'exit'))
            } # :SetAzureKeyVaultName while ($true)
            $ValidLocation = Get-AzLocation # Collects the list of all valid Azure locations
            :SetAzureKeyVaultLoc while ($true) { # Inner loop for setting the vault location
                $KeyVaultLocInput = Read-Host "New key vault location" # Operator input for the vault location
                if ($KeyVaultLocInput -eq 'exit') { # If $KeyVaultLocInput is 'exit'
                    Break NewAzureKeyVault # Breaks :NewAzureKeyVault
                } # if ($KeyVaultNameInput -eq 'exit')
                if ($KeyVaultLocInput -iin $ValidLocation.Location) { # if $KeyVaultLocInput is in $ValidLocation.Location (Case insensitive)
                    Write-Host $KeyVaultLocInput # Write $KeyVaultLocInput to screen
                    $OperatorConfirm = Read-Host "Is the location correct [Y] or [N]" # Operator confirmation
                    if ($OperatorConfirm -eq 'y' -or $OperatorConfirm -eq 'yes') { # If $OperatorConfirm is equal to 'y' or 'yes'
                        Break SetAzureKeyVaultLoc # Breaks :SetAzureKeyVaultLoc
                    } # End if ($OperatorConfirm -eq 'y' -or $OperatorConfirm -eq 'yes')
                } # End if ($KeyVaultLocInput -iin $ValidLocation)
                else { # All other inputs for $KeyVaultLocInput
                    Write-Host "The location provided is not valid" # Write message to screen
                    Write-Host "Select from the following" # Write message to screen
                    Write-Host "" # Write message to screen
                    Write-Host $ValidLocation.Location -Separator `n # Writes $ValidLocation.Location to screen
                } # End else (if ($KeyVaultLocInput -iin $ValidLocation))
            } # End :SetAzKeyVaultLoc while ($true)
            $KeyVaultObject = New-AzKeyVault -ResourceGroupName $RGObject.ResourceGroupName -Location $KeyVaultLocInput -Name $KeyVaultNameInput # Creates the new key vault and assigns to $KeyVaultObject
            Return $KeyVaultObject # Returns $var to calling function
        } # End :NewAzureKeyVault while ($true)
        Break # Returns to calling function empty
    } # End Begin
} # End function NewAzkeyvault
function GetAzKeyVault { # Collects a key vault object
    Begin {
        $ErrorActionPreference = 'silentlyContinue' # Disables error reporting
        :GetAzureKeyVault while ($true) { # Outer loop for managing function
            if (!$RGObject) { # If $RGObject is empty
                $RGObject = GetAzResourceGroup # Calls function and assigns output to $var
                if (!$RGObject) { # If $RGObject is still empty after returning
                    Break GetAzureKeyVault # Breaks :GetAzureKeyVault
                } # End if (!$RGObject)
            } # End if (!$RGObject)
            $KVList = Get-AzKeyVault -ResourceGroupName $RGObject.ResourceGroupName # Gets all key vaults in resource group and assigns to $KVList
            if (!$KVList) { # If $KVList returns empty
                Write-Host "No key vaults found" # Message write to screen
                Break GetAzureKeyVault # Breaks :GetAzureKeyVault
            } # End if (!$KVList)
            $KVListNumber = 1 # Sets the base value of the list
            Write-Host "0. Exit" # Adds exit option to beginning of list
            foreach ($_ in $KVList) { # For each item in list
                Write-Host $KVListNumber"." $_.VaultName # Writes the option number and key vault name
                $KVListNumber = $KVListNumber+1 # Adds 1 to $KVListNumber
            } # End foreach ($_ in $KVList)
            :SelectAzureKeyVault while ($true) { # Loop for selecting the key vault object
                $KVListNumber = 1 # Resets list number to 1
                $KVListSelect = Read-Host "Enter the option number" # Operator input for selecting which key vault
                if ($KVListSelect -eq '0') { # If $KVListSelect is equal to 0
                    Break GetAzureKeyVault # Breaks :GetAzureKeyVault
                } # End if ($KVListSelect -eq '0')
                foreach ($_ in $KVList) { # For each item in list
                    if ($KVListSelect -eq $KVListNumber) { # If the operator input matches the current $KVListNumber
                        $KeyVaultObject = $_ # Currently selected item in $KVList is assigned to $KeyVaultObject
                        Break SelectAzureKeyVault # Breaks :SelectAzureKeyVault
                    } # End if ($KVListSelect -eq $KVListNumber)
                    else { # If user input does not match the current $KVListNumber
                        $KVListNumber = $KVListNumber+1 # Adds 1 to $KVListNumber
                    } # End else (if ($KVListSelect -eq $KVListNumber))
                } # End foreach ($_ in $KVList)
                Write-Host "That was not a valid selection, please try again" # Write message to screen
            } # End :SelectAzureKeyVault while ($true)
            Return $KeyVaultObject # Returns $RGObject to calling function
        } # End :GetAzureKeyVault while ($true)
        Return # Returns to calling function with $null
    } # End Begin
} # End function GetAzKeyVault
function ListAzKeyVault { # Lists all key vaults in subscription
    Begin {
        #$ErrorActionPreference = 'silentlyContinue' # Disables error reporting
        $KVList = Get-AzKeyVault # Gets all key vaults and assigns to $KVList
        if (!$KVList) { # If $KVList returns empty
            Write-Host "No key vaults found" # Message write to screen
        } # End if (!$KVList)
        else { # If $KVList has a value
            foreach ($_ in $KVList) { # For each item in $KVList
                Write-Host "VaultName:" $_.VaultName "ResourceGroup:" $_.ResourceGroupName # Write message to screen 
            } # End else 
        } # End else (if (!$KVList))
        Return # Returns to calling function with $null
    } # End Begin
} # End function ListAzKeyVault
function RemoveAzKeyVault { # Removes $KeyVaultObject
    Begin {
        :RemoveAzureKeyVault while ($true) { # Outer loop for managing function
            if (!$KeyVaultKeyObject) { # If $KeyVaultKeyObject is empty
                $KeyVaultKeyObject = GetAzKeyVault # Calls function and assigns output to $var
                if (!$KeyVaultKeyObject) { # If $KeyVaultKeyObject is still empty after returning
                    Break RemoveAzureKeyVault # Breaks :RemoveAzureKeyVault
                } # End if (!$KeyVaultKeyObject)
            } # End if (!$KeyVaultKeyObject)
            Write-Host "Remove Vault "$KeyVaultKeyObject.VaultName "in resource group "$KeyVaultKeyObject.ResourceGroupName # Write message to screen
            $ConfirmDelete = Read-Host "[Y] or [N]" # Operator confirmation to delete the key vault
            if (!($ConfirmDelete -eq 'y')) { # If Confirm delete is not 'y'
                Write-Host "No action taken" # Write message to screen
                Break RemoveAzureKeyVault # Breaks :RemoveAzureKeyVault
            } # End if (!($ConfirmDelete -eq 'y'))
            else { # IF $ConfrimDelete is not 'y'
                Write-Host "Deleting "$KeyVaultKeyObject.VaultName # Write message to screen
                Remove-AzKeyVault -VaultName $KeyVaultKeyObject.VaultName -ResourceGroupName $KeyVaultKeyObject.ResourceGroupName -force # Removes the key vault
                Break RemoveAzureKeyVault # Breaks :RemoveAzureKeyVault
            } # End else if (!($ConfirmDelete -eq 'y'))
        } # End :RemoveAzureKeyVault while ($true)
        Return # Returns to calling function
    } # End Begin
} # End function RemoveAzKeyVault
function GetAzKeyVaultSecret { # Function to get a key vault secret
    Begin {
        $WarningPreference = "silentlyContinue" # Disables key vault warnings
        $ErrorActionPreference = 'silentlyContinue' # Disables error reporting
        :GetAzureKeyVaultSecret while ($true) { # Outer loop for managing function
            if (!$KeyVaultObject) { # If $KeyVaultObject is $null 
                $KeyVaultObject = GetAzKeyVault # Calls function and assigns output to $var
                if (!$KeyVaultObject) { # If $var is still $null
                    Break GetAzureKeyVaultSecret # Breaks :GetAzureKeyVaultSecret    
                } # End if (!$KeyVaultObject)
            } # End if (!$KeyVaultObject)
            $KVSecretlist = Get-AzKeyVaultSecret -VaultName $KeyVaultObject.VaultName # Creates list of all secrets in vault
            if (!$KVSecretlist) { # If $KVSecretlist returns empty
                Write-Host "No secrets found" # Message write to screen
                Break GetAzureKeyVaultSecret # Breaks :GetAzureKeyVaultSecret
            } # End if (!$KVSecretlist)
            $KVSecretlistNumber = 1 # Sets the base value of the list
            foreach ($_ in $KVSecretlist) { # For each item in list
                Write-Host $KVSecretlistNumber"." $_.Name # Writes list to screen
                $KVSecretlistNumber = $KVSecretlistNumber+1 # Adds 1 to $KVSecretlistNumber
            } # End foreach ($_ in $KVSecretlist) 
            Write-Host "0. Exit" # Write message to screen
            $KVSecretlistNumber = 1 # Resets list number to 1
            $KVSecretlistSelect = Read-Host "Enter the option number" # Operator input to select from list
            if ($KVSecretlistSelect -eq '0') { # If $KVSecretListSelect is 0
                Break GetAzureKeyVaultSecret # Breaks :GetAzureKeyVaultSecret
            } # End if ($KVSecretlistSelect -eq '0')
            :SelectAzureKeyVaultSecret foreach ($_ in $KVSecretlist) { # For each item in list
                if ($KVSecretlistSelect -eq $KVSecretlistNumber) { # If the user input matches the current $KVSecretlistNumber
                    $KeyVaultSecretObject = $_ # Edit this to assign to whatever varible
                    Break SelectAzureKeyVaultSecret # Breaks :SelectAzureKeyVaultSecret
                } # End if ($KVSecretlistSelect -eq $KVSecretlistNumber)
                else { # If user input does not match the current $KVSecretlistNumber
                    $KVSecretlistNumber = $KVSecretlistNumber+1 # Adds 1 to $KVSecretlistNumber
                } # End else (if ($KVSecretlistSelect -eq $KVSecretlistNumber))
            } # End :SelectAzureKeyVaultSecret
            Return $KeyVaultSecretObject # Returns $KeyVaultSecretObject to calling function
        } # End :GetAzureKeyVaultSecret while ($true) {
        Return # Returns $null to calling function
    } # End begin statement
} # End GetAzKeyVaultSecret